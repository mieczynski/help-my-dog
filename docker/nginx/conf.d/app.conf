server {
listen 80 default_server;
server_name _;


# Symfony API lives here
root /var/www/html/api/public;


client_max_body_size 32m;
index index.php index.html;


location /healthz {
return 200 'ok';
add_header Content-Type text/plain;
}


# Default: route everything to Symfony front controller
location / {
try_files $uri /index.php$is_args$args;
}


location ~ \.php$ {
include fastcgi_params;
fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
fastcgi_param DOCUMENT_ROOT $realpath_root;
fastcgi_pass php:9000;
fastcgi_read_timeout 60s;
internal;
}


location ~* \.(?:css|js|jpg|jpeg|gif|png|svg|ico|webp)$ {
expires 7d;
access_log off;
try_files $uri =404;
}


location ~ /\.(?!well-known).* { deny all; }
location ~* \/(composer\.(json|lock)|package\.(json|lock)|symfony\.lock)$ { deny all; }
}